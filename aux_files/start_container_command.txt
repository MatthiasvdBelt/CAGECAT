# if we want to recreate the container. Make sure that:
 # 1. cwd has most recentDockerfile
 # 3. cwd has supervisord.conf file
 # 5. cwd has empty pfam_db folder

docker rm cagecat_service && \
rm -rf repo && git clone git@git.wur.nl:belt017/thesis_repo.git && \
mv thesis_repo/ repo && \
docker build -t cagecat . && \
docker run --name cagecat_service -p 5001:88 --ip 172.17.0.14 --mount source=cagecat_storage,target=/repo/cagecat -v /lustre/BIF/nobackup/belt017/databases:/hmm_databases -v /lustre/BIF/nobackup/belt017/backups:/backups -d cagecat

# !! important -- volume binding and mounting cannot be done from Dockerfile and should be done from the CLI when building the Docker container, as in with the command above
# TODO: maybe volume bind of hmm_database genome files can be removed

### Building and using development container ###

# Step 1
    # docker build -t cagecat_dev . && \
    # docker run --name cagecat_dev --ip 172.17.0.12 -d cagecat_dev
    # possible to add "-v /lustre/BIF/nobackup/belt017/databases:/hmm_databases" when interacting with hmm_databases

# Step 2
    # connecting to the container:
        # ssh -A -t -l <your_wur_username> bioinformatics.nl -L 9999:localhost:9999 ssh -A -t -l <your_wur_username> thornton.bioinformatics.nl -L 9999:<Docker_container_ip>:88

# Step 3
    # get terminal of container and make development adjustments
        # docker exec -it cagecat_dev bash
    # make hmm_databases directory
        # mkdir /hmm_databases # if non-existing
    # create dummy sensitive.py file
        # touch /repo/config_files/sensitive.py
    # remove cagecat URL prepend line from /repo/config_files/uwsgi_params file
        # no command, manually remove following line:
        # uwsgi_param  SCRIPT_NAME        /cagecat;
    # reload nginx configuration file
        # nginx -s reload
    # run command below for changes to take effect:
        # uwsgi --reload /tmp/uwsgi-master.pid

# Step 4
    # viewing the development container:
        # go to 127.0.0.1:9999 in your local browser

# Step 5
    # run command below for changes to take effect:
        # uwsgi --reload /tmp/uwsgi-master.pid

### Building and using development container ###