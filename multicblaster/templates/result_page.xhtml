{% extends "base.xhtml" %}

{% block title %}
    Job status
{% endblock %}

<!--This page will show the status of the job (job unfinished), or the results of -->
<!--        the job (job finished)-->

{% block content %}
    <p>The status of job: <b>{{ j_id }}</b> is: {{ status }}</p>

    <form action="/download-results/{{j_id}}" method="post"
          enctype="multipart/form-data" name="download_settings">
    <input name="job_id" type="hidden" value="{{j_id}}"/>
    <select name="compression_type">
        {% for compr in compr_formats %}
        <option name="{{compr}}" value="{{compr}}">{{compr}}</option>

        {% endfor %}
    </select>
<!--    <input name=""/>-->
    <input type="submit" value="Download"/>
    </form>

<div>
<label>
    <input onclick="toggleElementVisibility('logSection')" type="checkbox"/>Show log</label>
</div>
<div id="logSection" style="display: none">
    <p class="log">{{log_contents|safe}}</p>
</div>

        {% if module in select_cluster_modules %}
<hr/>
<div>
    <form action="{{url_for('extract_sequences')}}" method="post" onsubmit="addSelectedToForm('sequences')">
        <input type="hidden" name="job_id" value="{{j_id}}"/>
        <input type="hidden" id="selectedQueries" name="selectedQueries" value=""/>
        <input type="hidden" id="selectedClusters" name="selectedClusters" value=""/>
        <button type="submit">Extract sequences</button>
    </form>
    <br/>

    <form action="{{url_for('extract_clusters')}}" method="post" onsubmit="addSelectedToForm('clusters')">
        <input type="hidden" name="job_id" value="{{j_id}}"/>
        <input type="hidden" name="selectedClusters" id="selectedClusters1" value=""/>
        <button type="submit">Extract clusters</button>
    </form>

</div>
<br/>
<div>
    <form action="{{ url_for('corason')}}" method="post" onsubmit="addSelectedToForm('corason')">
        <input type="hidden" name="job_id" value="{{j_id}}"/>
        <input type="hidden" name="selectedQuery" id="selectedQuery" value=""/>
        <input type="hidden" name="selectedClusters" id="selectedClusters2" value=""/>
        <input type="hidden" name="selectedReferenceCluster" id="referenceCluster" value=""/>
        <button type="submit" id="corasonSubmit" disabled="disabled">Use CORASON</button>
    </form>
</div>
<br/>
<label for="selectedQueriesOverview">Selected queries</label>
<ul id="selectedQueriesOverview">
    <li>No queries selected</li>
</ul>

<label for="selectedClustersOverview">Selected clusters</label>
<ul id="selectedClustersOverview">
    <li>No clusters selected</li>
</ul>
<label for="selectedReferenceCluster">Selected reference cluster</label>
<ul id="selectedReferenceCluster">
    <li>No reference cluster selected</li>
</ul>


<div>
    <iframe {{'onload=loadedIframe(this)' if module in select_cluster_modules}} height="600" id="newWindow" srcdoc="{{plot_contents}}" title="Generated HTML plot"></iframe>
</div>

<hr/>
<div>
    <a href="{{url_for('home_page', prev_run_id=job_id)}}"><button>Reanalyze</button></a>
</div>
        {% endif %}
{% endblock %}










