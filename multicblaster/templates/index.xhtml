{% extends "base.xhtml" %}
{% from "macros.xhtml" import prev_session %}
{% from "macros.xhtml" import result_table %}


{% block title %}
    multicblaster
{% endblock %}
{% block scripts %}
    {% if module_to_show == 'visualization' %}
showModule(undefined, 'clinkerContent');
    {% elif module_to_show == 'gne' %}
showModule(undefined, 'gneModuleContent');
    {% elif module_to_show == 'recompute' %}
document.getElementById('radioPrevSession').click();
    {% endif %}

{% endblock %}

{% block content %}

<!--Module buttons-->
<div class="modules">
    <button class="button moduleSelector" onclick="showModule(event,
    'searchModuleContent')">Search
    </button>
    <button class="button moduleSelector" id="showGNE"
            onclick="showModule(event, 'gneModuleContent')">Neighbourhood
    </button>

    <button class="button moduleSelector" onclick="showModule(event,'clinkerContent')">Visualization</button>
<!--    <button class="moduleSelector"-->
<!--            onclick="showModule(event, 'extractModuleContent')">Extract-->
<!--    </button>-->
</div>
<br/>

<!--Module contents-->
<div>

<div id="searchModuleContent" class="moduleContent">
<form method="post" enctype="multipart/form-data" action="{{submit_url}}"
      onsubmit="return validateForm()" name="searchOptionForm">
    <input type="hidden" name="job_type" value="search" required="required"/>

    <label class="fieldset-label" for="inputSection">Input</label>
    <fieldset id="inputSection">

        <label>
        <input type="radio" value="fasta" checked="checked" id="radioFasta"
               name="inputType" onclick="showInputOptions('fasta')"/>FASTA</label>
        <label>
        <input type="radio" value="ncbi_entries" id="radioNCBIEntries"
               name="inputType"
               onclick="showInputOptions('ncbi_entries')"/>NCBI entries
        </label>
        <label>
        <input type="radio" value="prev_session" id="radioPrevSession"
               name="inputType"
                onclick="showInputOptions('prev_session')"/>Recompute
        </label>

    <div id="genomeFileUploadDiv">
        <label class="file-upload-lbl" for="genomeFile">
        <input type="file" id="genomeFile" name="genomeFiles"
               required="required"/>Query</label>
    </div>
    <div id="ncbiEntriesDiv" style="display: none">
        <label for="ncbiEntriesTextArea">NCBI identifiers</label>
        <textarea rows="6" cols="25" id="ncbiEntriesTextArea"
                  name="ncbiEntriesTextArea" placeholder="NCBI accessions" disabled="disabled" onfocusout="validateNCBIEntries()"></textarea>
    </div>
    <div id="accessionsError" style="display: none">
        <span id="accessionsErrorText"></span>
    </div>
    {{ prev_session('search', false, prev_run_id, false) }}

</fieldset>
    <br/>

    <label class="fieldset-label" for="searchSection">Search</label>
<fieldset id="searchSection">
    <div>
        <label class="input-label" for="database_type">Database</label>
        <select class="select-options" id="database_type" name="database_type" required="required">
            <option value="nr">nr</option>
            <option value="refseq_protein">refseq_protein</option>
            <option value="swissprot">swissprot</option>
            <option value="pdb">pdb</option>
        </select>
    </div>
    <div>

        <label class="input-label" for="entrez_query">Entrez query</label>
        <input type="text" name="entrez_query"
               id="entrez_query" placeholder="Aspergillus[organism]"/>
    </div>
    <div>
        <label class="input-label" for="max_hits">Maximum hits</label>
        <input type="number" required="required" name="max_hits"
               id="max_hits" min="1" step="1"
               value="5000"/>
    </div>
</fieldset>
    <br/>
    <label class="fieldset-label" for="filteringSection">Filtering</label>
<fieldset id="filteringSection">
    <div>
        <label class="input-label" for="max_evalue">Max. e-value</label>
        <input type="number" required="required" value="0.01" step="0.01" id="max_evalue"
           name="max_evalue"/>
    </div>
    <div>
        <label class="input-label" for="min_identity">Min. identity (%)</label>
        <input type="number" required="required" value="30"
               id="min_identity" name="min_identity"/>
    </div>

    <div>
        <label class="input-label" for="min_query_coverage">Min. query coverage (%)</label>
        <input type="number" required="required" value="50" id="min_query_coverage"
               name="min_query_coverage"/>
    </div>

</fieldset>

    <br/>
    <label class="fieldset-label" for="clusteringSection">Clustering</label>
    <fieldset id="clusteringSection">
        <div>
            <label class="input-label" for="max_intergenic_gap">Max. intergenic gap</label>
            <input type="number" id="max_intergenic_gap"
                   name="max_intergenic_gap" value="20000" step="1" required="required"/>
        </div>
        <div>
            <label class="input-label" for="min_unique_query_hits">Min. unique query hits</label>
            <input type="number" id="min_unique_query_hits"
                   name="min_unique_query_hits" value="3" step="1" min="0"
                   required="required"/>
        </div>
        <div>
            <label class="input-label" for="min_hits_in_clusters">Min. hits in clusters</label>
            <input type="number" id="min_hits_in_clusters"
                   name="min_hits_in_clusters" value="3" step="1" min="0" required="required"/>
        </div>

        <div>
            <label class="input-label" for="percentageQueryGenes">Percentage</label>
            <input type="number" name="percentageQueryGenes" id="percentageQueryGenes" value="50" min="0" max="100" step="1" required="required"/>
        </div>
        <div>
            <label>
                <input type="checkbox" id="requiredSequencesCheckbox"
                       name="requiredSequencesCheckbox"
                       onclick="toggleDisabled('requiredSequences')">Required sequences</input>
            </label>
            <div id="requiredSequencesTextarea">
                <textarea rows="4" cols="25" name="requiredSequences"
                          id="requiredSequences" placeholder="NCBI entry"
                          disabled="disabled" required="required"></textarea>
            </div>
        </div>
    </fieldset>
    <br/>
    {{ result_table('search', "Sum") }}
    <br/>
    {{ result_table('search', "Bin") }}
    <br/>

    <label class="fieldset-label" for="generalOptionSection">Additional options</label>
    <fieldset id="generalOptionSection">
        <label class="input-label">
            <input type="checkbox" id="sortClusters" name="sortClusters">Sort
                clusters
            </input>
        </label>
<!--        <label>-->
<!--            <input type="checkbox" id="generatePlot"-->
<!--                   name="generatePlot">Generate plot-->
<!--            </input>-->
<!--        </label>-->
    </fieldset>

    <br/>
    <input type="submit" class="submit_button" id="submitSearchForm" value="Run"/>

    </form>
</div>

<div id="gneModuleContent" class="moduleContent" style="display: none">
    <form method="post" enctype="multipart/form-data" action="{{submit_url}}"
          onsubmit="return validateForm()" name="gneOptionForm">

        <input type="hidden" name="job_type" value="gne" required="required"/>
        <label class="fieldset-label" for="gneInputSection">Input</label>
        <fieldset id="gneInputSection">
        {{ prev_session('gne', true, prev_run_id, false) }}
        </fieldset>
        <br/>

        {{ result_table('gne', 'Sum') }}
        <br/>
        <label class="fieldset-label" for="gneOptions">Extra options</label>
        <fieldset id="gneOptions">
            <div>
                <label for="max_intergenic_distance">Max. intergenic distance</label>
                <input type="number" id="max_intergenic_distance" name="max_intergenic_distance" value="100000" required="required" step="1" min="0"/>
            </div>
            <div>
                <label for="sample_number">Number of samples</label>
                <input type="number" id="sample_number" name="sample_number" value="100" step="1" min="1" required="required"/>
            </div>
            <div>
                <label for="sampling_space">Sampling space</label>
                <select class="select-options" name="sampling_space" id="sampling_space" required="required">
                    <option name="spaceLinear" value="linear">linear</option>
                    <option name="spaceLog" value="log">log</option>
                </select>
            </div>
        </fieldset>
        <br/>
        <input type="submit" class="submit_button" id="submitGNEForm"  value="Run"/>
    </form>
</div>

<div id="clinkerContent" class="moduleContent" style="display: none">
    <form action="{{submit_url}}" method="post">
        <input type="hidden" name="job_type" value="clinker_full"/>
        <label class="fieldset-label" for="clinkerInputSection">Input</label>
        <fieldset id="clinkerInputSection">
            {{ prev_session('clinker', true, prev_run_id, true) }}
        </fieldset>
        <label class="fieldset-label" for="clinkerAlignmentSection">Alignment</label>
        <fieldset id="clinkerAlignmentSection">
            <label>
                <input type="checkbox" name="noAlign"/>Don't align clusters
            </label>
            <div>
                <label class="input-label" for="identity">Min. alignment sequence identity</label>
                <input type="number" id="identity" name="identity" required="required" min="0" max="1" value="0.3" step="0.01"/>
{#                TODO check which values are valid for identity#}
    {#            TODO number of CPU's --> add in workers.py#}
            </div>

        </fieldset>
        <label class="fieldset-label" for="clinkerOutputSection">Output</label>
        <fieldset id="clinkerOutputSection">
            <div>
                <label class="input-label"
                       for="clinkerDelim">Delimiter</label>
                <input type="text" id="clinkerDelim" name="clinkerDelim" maxlength="1"/>
            </div>
            <div>
                <label class="input-label"
                       for="clinkerDecimals">Decimal places</label>
                <input type="number" id="clinkerDecimals" name="clinkerDecimals" value="2" step="1" min="0"
                       required="required"/>
            </div>
            <label>
            <input type="checkbox" name="hideLinkHeaders"/>Hide alignment column headers</label>

            <div>
            <label>
                <input type="checkbox" name="hideAlignHeaders"/>Hide alignment cluster name headers</label>
{#            {{ result_table('clinker', '') }}#}
            </div>
        </fieldset>
        <label class="fieldset-label" for="clinkerVisualiationSection">Additional options</label>
        <fieldset id="clinkerVisualiationSection">
            <label>
            <input type="checkbox" name="useFileOrder"/>Maintain order of input files</label>
        </fieldset>


        <input type="submit" value="Visualize!"/>
    </form>
</div>

<!--<div id="extractModuleContent" class="moduleContent" style="display: none">-->
<!--    <form method="post" enctype="multipart/form-data" action="{{submit_url}}"-->
<!--          onsubmit="return validateForm()" name="extractOptionForm">-->
<!--        <input type="hidden" name="job_type" value="extract"-->
<!--               required="required"/>-->

<!--        {{ prev_session('extract', true, prev_run_id) }}-->
<!--        <input type="submit" class="submit_button" value="Run"/>-->
<!--    </form>-->
<!--</div>-->
</div>


{% endblock %}